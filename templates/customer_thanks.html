<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'includes/head.html' %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>Thank You for Your Order!</title>
    <style>
        :root { --success: #2e8b57; --primary: #4361ee; }
        body { min-height: 100vh; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); font-family: 'Segoe UI', sans-serif; }
        .card {
            max-width: 560px; margin: 3rem auto; padding: 3rem 2.5rem;
            border-radius: 20px; background: white; box-shadow: 0 20px 50px rgba(0,0,0,0.15); text-align: center;
        }
        .icon { font-size: 5rem; color: var(--success); margin-bottom: 1rem; }
        h1 { color: var(--success); font-weight: 800; font-size: 2.8rem; }
        .info { background: #f0f8f4; border-left: 6px solid var(--success); padding: 1.5rem; border-radius: 12px; margin: 2rem 0; text-align: left; font-size: 1.05rem; }
        .btn-success { background: linear-gradient(135deg, #2e8b57, #3cb371); color: white; padding: 1rem 2.5rem; font-size: 1.2rem; border-radius: 50px; text-decoration: none; box-shadow: 0 10px 25px rgba(46,139,87,0.3); display: inline-block; }
        .btn-success:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(46,139,87,0.4); }
        .btn-home { background: #6c757d; color: white; padding: 1rem 2rem; border-radius: 50px; text-decoration: none; margin-top: 1rem; display: inline-block; }
        .btn-home:hover { background: #5a6268; }
    </style>
</head>
<body>

    <!-- Confetti -->
    <div id="confetti" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-1;"></div>

    {% include 'includes/navbar.html' %}

    <main class="container my-5">
        <div class="card">
            <div class="icon">
                <i class="bi bi-check-circle-fill"></i>
            </div>

            <h1>Thank You{% if name %}, {{ name.split(' ')[0] }}{% endif %}!</h1>

            {% if paid %}
                <p class="lead text-success fw-bold fs-4">Payment Received Successfully!</p>
            {% else %}
                <p class="lead text-primary fw-bold fs-4">Order Placed (Cash on Delivery)</p>
            {% endif %}

            <div class="info">
                <p><strong>Order ID:</strong>
                    <span class="text-primary fw-bold">
                        {% if bill_number %}
                            {{ bill_number }}
                        {% else %}
                            COD-{{ "%Y%m%d%H%M%S"|strftime(now()) }}
                        {% endif %}
                    </span>
                </p>

                {% if amount_khr and amount_khr > 0 %}
                    <p><strong>Amount Paid:</strong>
                        <span class="text-success fw-bold">{{ "%.0f"|format(amount_khr) }} KHR</span>
                        (≈ ${{ "%.2f"|format(amount_khr / 4060) }})
                    </p>
                {% endif %}

                <p><strong>Delivery Address:</strong><br>
                    <span class="text-dark">{{ address or 'Will be confirmed soon' }}</span>
                </p>

                <p><strong>Estimated Delivery:</strong> 1–3 days in Phnom Penh</p>
            </div>

            {% if has_invoice %}
                <a href="{{ url_for('download_invoice') }}" class="btn-success">
                    Download Invoice (PDF)
                </a>
                <br>
            {% endif %}

            <p class="mt-4 text-muted">
                Order confirmation sent to your phone & email.<br>
                Our team will contact you shortly!
            </p>

            <a href="{{ url_for('index') }}" class="btn-home">
                Continue Shopping
            </a>
        </div>
    </main>

    <footer class="bg-dark text-white py-5">
        {% include 'includes/footer.html' %}
    </footer>

    <!-- Confetti Celebration -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        setTimeout(() => {
            confetti({ particleCount: 180, spread: 70, origin: { y: 0.6 } });
        }, 500);

        let bursts = 0;
        const interval = setInterval(() => {
            if (bursts < 6) {
                confetti({
                    particleCount: 50,
                    angle: Math.random() * 360,
                    spread: 90,
                    origin: { x: Math.random(), y: Math.random() * 0.5 }
                });
                bursts++;
            } else {
                clearInterval(interval);
            }
        }, 900);
    </script>
</body>
</html>